<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ロト6結果検索ツール</title>
<!-- (ここまでヘッダー・CSSはv1.01そのままなので省略) -->
</head>
<body>
<!-- (ここもh1タイトル、フィルター欄、テーブル定義もv1.01そのまま) -->

<script>
let data = [];

function formatYen(value) {
  if (!value) return "0円";
  if (isNaN(value)) return "-";
  const intVal = parseInt(value);
  return isNaN(intVal) ? value : intVal.toLocaleString() + "円";
}

async function loadData() {
  try {
    const res = await fetch("./loto6.json");
    data = await res.json();

    // 【追加修正】ここで「開催回」の降順にそろえる
    data.sort((a, b) => Number(b['開催回']) - Number(a['開催回']));

    renderTable(data);

    const dates = data.map(item => item["日付"]).sort();
    const latest = dates[dates.length - 1];
    document.getElementById("lastUpdated").innerHTML = `データ更新日：${latest} ｜ツールVer：<a href="https://www.kujitonari.net/loto_search_tool" target="_blank" style="color:#d94f4f;text-decoration:underline;">1.01</a>`;
  } catch (e) {
    console.error("データ読み込み失敗:", e);
  }
}

function renderTable(filteredData) {
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";
  filteredData.forEach(item => {
    const nums = [item["第1数字"], item["第2数字"], item["第3数字"], item["第4数字"], item["第5数字"], item["第6数字"]].join("・");
    const row = `
      <tr>
        <td>${item["開催回"]}</td><td>${item["日付"]}</td><td>${nums}</td><td>${item["ボーナス数字"]}</td><td>${(item["特徴"] || "").split("・").map(f => `<a href="#" onclick="featureQuickSearch('${f}')">${f}</a>`).join("・")}</td>
        <td>${formatYen(item["1等賞金"])}</td><td>${item["1等口数"]}</td>
        <td>${formatYen(item["2等賞金"])}</td><td>${item["2等口数"]}</td>
        <td>${formatYen(item["3等賞金"])}</td><td>${item["3等口数"]}</td>
        <td>${formatYen(item["4等賞金"])}</td><td>${item["4等口数"]}</td>
        <td>${formatYen(item["5等賞金"])}</td><td>${item["5等口数"]}</td>
        <td>${formatYen(item["キャリーオーバー"])}</td>
      </tr>`;
    tbody.insertAdjacentHTML("beforeend", row);
  });
}

// 以下、フィルターやリセットなど v1.01のコードそのまま(省略)

// ページ読み込み時に実行
document.addEventListener("DOMContentLoaded", () => {
  loadData();

  const headers = document.querySelectorAll("#resultTable th");
  headers.forEach((header, index) => {
    header.style.cursor = "pointer";
    header.addEventListener("click", () => sortTable(index));
  });
});

// 残りのソート、フィルター、リセット、ポップアップ処理などもv1.01そのままです
</script>

</body>
</html>
